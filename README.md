# –î–∏–ø–ª–æ–º–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –ø–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ ¬´Fullstack-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ Python¬ª

## ‚òÅÔ∏è –û–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ My Cloud

–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å, –∑–∞–≥—Ä—É–∂–∞—Ç—å, –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å, —Å–∫–∞—á–∏–≤–∞—Ç—å –∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞—Ç—å —Ñ–∞–π–ª—ã. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è, –ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –≤ –∞–∫–∫–∞—É–Ω—Ç, –≤—ã—Ö–æ–¥–∏—Ç—å –∏–∑ –Ω–µ–≥–æ. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ —Å–≤–æ–µ–º—É –∞–∫–∫–∞—É–Ω—Ç—É –∏ —Å–≤–æ–∏–º —Ñ–∞–π–ª–∞–º. –ï—Å—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ‚Äî –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –≤—Å–µ –≤—ã—à–µ—É–ø–æ–º—è–Ω—É—Ç—ã–µ –¥–µ–π—Å—Ç–≤–∏—è —Å –ª—é–±—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏–ª–∏ —Ñ–∞–π–ª–∞–º–∏.

## üõ† Tech stack

Django, React, Redux.  
–ü–æ–ª–∞–≥–∞—é —É –≤–∞—Å —É–∂–µ —Å—Ç–æ–∏—Ç Python v.3.10+, NodeJS v.18+, PostgreSQL v.14+.

## üîÆ –õ–æ–∫–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

- –∫–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
```
$ git clone https://github.com/lulzseq/netology-cloud-storage.git
$ cd netology-cloud-storage
```
### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

- —Å–æ–∑–¥–∞–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL
```
$ psql

# CREATE DATABASE django_db;
```
### –ë—ç–∫–µ–Ω–¥
- –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
```
$ python -m venv env
$ source ./env/bin/activate
```
–°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª `.env`, –≥–¥–µ —É–∫–∞–∑—ã–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL –∏ Django Secret Key:
```
# Django

DJANGO_SECRET_KEY = '<DJANGO_SECRET_KEY>'

POSTGRES_DB = 'django_db'
POSTGRES_USER = '<–ª–æ–≥–∏–Ω>'
POSTGRES_PASSWORD = '<–ø–∞—Ä–æ–ª—å>'
POSTGRES_HOST = 'http://<IP —Å–µ—Ä–≤–µ—Ä–∞>'
POSTGRES_PORT = '5432'

# React

REACT_APP_API_URL = 'http://<IP —Å–µ—Ä–≤–µ—Ä–∞>'

# –ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏ —ç—Ç–æ –±—É–¥–µ—Ç http://127.0.0.1:8000
```

- –∑–∞–ø—É—Å–∫–∞–µ–º –±—ç–∫–µ–Ω–¥
```
(env) $ pip install -r requirements.txt
(env) $ python manage.py makemigrations accounts
(env) $ python manage.py makemigrations storage
(env) $ python manage.py migrate
(env) $ python manage.py runserver
```
–ü—É—Ç–∏ –¥–ª—è API:

```
POST /register/ —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
POST /login/ –ª–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
GET /logout/ –ª–æ–≥–∞—É—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
PATCH /api/users/<id> –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID
DELETE /api/users/ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

GET /api/users/ –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö —é–∑–µ—Ä–æ–≤ (–∏–ª–∏ —Ç–æ–ª—å–∫–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
GET /api/users/<id> –ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —é–∑–µ—Ä–∞ –ø–æ ID

GET /api/files/ –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã
GET /api/files/<id> –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ —Ñ–∞–π–ª–∞ –ø–æ ID

POST /api/files/ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª (form-data)
PATCH /api/files/<id> –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Ñ–∞–π–ª –ø–æ ID
DELETE /api/files/<id> —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª –ø–æ ID
```
### –§—Ä–æ–Ω—Ç–µ–Ω–¥
- –∑–∞–ø—É—Å–∫–∞–µ–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
```
(env) $ yarn
(env) $ yarn start
```

## üé∞ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

- –∫–æ–Ω–Ω–µ–∫—Ç–∏–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
```
$ ssh root@<IP —Å–µ—Ä–≤–µ—Ä–∞>
```
- —Å–æ–∑–¥–∞–µ–º —é–∑–µ—Ä–∞, –¥–∞–µ–º –µ–º—É –ø—Ä–∞–≤–∞ –∏ –∫–æ–Ω–Ω–µ–∫—Ç–∏–º—Å—è —Å –Ω–∏–º
```
$ adduser <unix_username>
$ usermod <unix_username> -aG sudo
$ su - <unix_username>
```
- –æ–±–Ω–æ–≤–ª—è–µ–º –ø–∞–∫–µ—Ç—ã, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–µ
```
$ sudo apt update
$ sudo apt upgrade
$ sudo apt install python3-venv python3-pip postgresql nginx
```
- –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ Nginx –∑–∞–ø—É—â–µ–Ω
```
$ sudo systemctl start nginx
$ sudo systemctl status nginx
```
- –∫–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –∑–∞—Ö–æ–¥–∏–º –≤ –Ω–µ–≥–æ
```
$ git clone https://github.com/lulzseq/netology-cloud-storage.git
$ cd netology-cloud-storage
```
### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- –Ω–µ –∑–∞–±—É–¥–µ–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `postgres`
```
$ sudo su postgres
$ psql

# CREATE DATABASE django_db;
# CREATE USER <username> WITH PASSWORD '<passowrd>';
# GRANT ALL PRIVILEGES ON DATABASE django_db TO <username>;
# \q

$ exit
```
### –ë—ç–∫–µ–Ω–¥
- —Å–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª `.env` –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
```
# Django

DJANGO_SECRET_KEY = '<DJANGO_SECRET_KEY>'

POSTGRES_DB = 'django_db'
POSTGRES_USER = '<–ª–æ–≥–∏–Ω>'
POSTGRES_PASSWORD = '<–ø–∞—Ä–æ–ª—å>'
POSTGRES_HOST = 'http://<IP —Å–µ—Ä–≤–µ—Ä–∞>'
POSTGRES_PORT = '5432'

# React

REACT_APP_API_URL = 'http://<IP —Å–µ—Ä–≤–µ—Ä–∞>'
```
- —Å–æ–∑–¥–∞–µ–º –∏ –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
```
$ python3 -m venv env
$ source ./env/bin/activate
```
- —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python, –ø—Ä–∏–º–µ–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –±—ç–∫–µ–Ω–¥
```
(env) $ pip install -r requirements.txt
(env) $ python manage.py makemigrations accounts
(env) $ python manage.py makemigrations storage
(env) $ python manage.py migrate
(env) $ python manage.py runserver 0.0.0.0:8000
```
–°–µ–π—á–∞—Å Django –ø—Ä–æ–µ–∫—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É http://<IP —Å–µ—Ä–≤–µ—Ä–∞>:8000.
- –ø–∏—à–µ–º –∫–æ–Ω—Ñ–∏–≥ Gunicorn
```
(env) $ sudo nano /etc/systemd/system/gunicorn.service
```
–í —Ñ–∞–π–ª–µ –ø–∏—à–µ–º —Å–ª–µ–¥—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–≤–º–µ—Å—Ç–æ `<unix_username>` –Ω–∞–¥–æ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å –≤–∞—à–µ –∏–º—è —é–∑–µ—Ä–∞):
```
[Unit]
Description=gunicorn.service
After=network.target

[Service]
User=dima
Group=www-data
WorkingDirectory=/home/<unix_username>/netology-cloud-storage
ExecStart=/home/<unix_username>/netology-cloud-storage/env/bin/gunicorn --access-logfile - --workers=3 --bind unix:/home/<unix_username>/netology-cloud-storage/server/gunicorn.sock server.wsgi:application

[Install]
WantedBy=multi-user.target
```
- –∑–∞–ø—É—Å–∫–∞–µ–º Gunicorn
```
(env) $ sudo systemctl start gunicorn
(env) $ sudo systemctl enable gunicorn
```
- –ø–∏—à–µ–º –∫–æ–Ω—Ñ–∏–≥ Nginx
```
(env) $ sudo nano /etc/nginx/sites-available/netology-cloud-storage
```
–í —Ñ–∞–π–ª–µ –ø–∏—à–µ–º —Å–ª–µ–¥—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–≤–º–µ—Å—Ç–æ `<unix_username>` –Ω–∞–¥–æ –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å –≤–∞—à–µ –∏–º—è —é–∑–µ—Ä–∞):
```
server {
	listen 80;
	server_name 82.97.243.191;

	location /static/ {
		root /home/<unix_username>/netology-cloud-storage;
	}
        
        location /static/js/ {
        alias /home/<unix_username>/netology-cloud-storage/build/static/js/;
    }

       location /static/css/ {
        alias /home/<unix_username>/netology-cloud-storage/build/static/css/;
    }

	location ~ ^/(api|login|register|logout|s)/ {
        include proxy_params;
        proxy_pass http://unix:/home/<unix_username>/netology-cloud-storage/server/gunicorn.sock;
    }

	location / {
		root /home/<unix_username>/netology-cloud-storage/build/;
        try_files $uri /index.html;
	}
}
```
- –¥–µ–ª–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –Ω–µ–≥–æ
```
(env) $ sudo ln -s /etc/nginx/sites-available/netology-cloud-storage /etc/nginx/sites-enabled
```
- –æ—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ—Ä—Ç—ã –∏ –¥–∞–µ–º –ø—Ä–∞–≤–∞ Nginx
```
(env) $ sudo ufw allow 8000
(env) $ sudo ufw allow 80
(env) $ sudo ufw allow 'Nginx Full'
```
- –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–ª—É–∂–±—ã –∞–∫—Ç–∏–≤–Ω—ã
```
(env) $ sudo systemctl status gunicorn
(env) $ sudo systemctl status nginx
```
- –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ª—É–∂–±—ã
```
(env) $ sudo systemctl daemon-reload
(env) $ sudo systemctl restart gunicorn
(env) $ sudo systemctl restart nginx
```
–¢–µ–ø–µ—Ä—å Django –ø—Ä–æ–µ–∫—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ http://<IP —Å–µ—Ä–≤–µ—Ä–∞> –Ω–∞ –æ–±—ã—á–Ω–æ–º –ø–æ—Ä—Ç—É 80. –ï—Å–ª–∏ –≤–∏–¥–∏–º –æ—à–∏–±–∫—É 502, —Ç–æ, –≤–æ–∑–º–æ–∂–Ω–æ, –¥–µ–ª–ª–æ –≤ –ø—Ä–∞–≤–∞—Ö –∏ –º–µ–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —é–∑–µ—Ä–∞ –Ω–∞ –∏–º—è –Ω–∞—à–µ–≥–æ —é–∑–µ—Ä–∞:
```
(env) $ sudo nano /etc/nginx/nginx.conf
```
```
...
...
user <unix_username>
...
...
```
- –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ª—É–∂–±—ã –µ—â–µ —Ä–∞–∑ –∏ Django –ø—Ä–æ–µ–∫—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ http://<IP —Å–µ—Ä–≤–µ—Ä–∞> –Ω–∞ –æ–±—ã—á–Ω–æ–º –ø–æ—Ä—Ç—É 80:
```
(env) $ sudo systemctl daemon-reload
(env) $ sudo systemctl restart gunicorn
(env) $ sudo systemctl restart nginx
```
- –≤—ã—Ö–æ–¥–∏–º –∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±—Ä–∞—Ç–Ω–æ –≤ `root`
```
(env) $ exit
```
### –§—Ä–æ–Ω—Ç–µ–Ω–¥
- —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º NodeJS v.18+ –∏ —Å–≤–µ–∂–∏–π Yarn
```
$ curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash - 
$ sudo apt-get install -y nodejs

$ curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
$ echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
$ sudo apt update && sudo apt install yarn
```
- –∑–∞—Ö–æ–¥–∏–º –æ–±—Ä–∞—Ç–Ω–æ –≤ –Ω–∞—à–µ–≥–æ —é–∑–µ—Ä–∞
```
$ su - <unix_username>
```
- —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∑–∞–ø—É—Å–∫–∞–µ–º —Å–±–æ—Ä–∫—É —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
```
$ yarn
$ yarn build
```
- –ø—Ä–æ–≤–µ—Ä—è–µ–º Nginx –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –µ–≥–æ
```
$ sudo nginx -t
$ sudo systemctl restart nginx
```
–¢–µ–ø–µ—Ä—å –ø—Ä–æ–µ–∫—Ç Django + React –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ http://<IP —Å–µ—Ä–≤–µ—Ä–∞> –Ω–∞ –æ–±—ã—á–Ω–æ–º –ø–æ—Ä—Ç—É 80.
## üëÆ‚Äç‚ôÄÔ∏è License
- [MIT](https://github.com/lulzseq/netology-cloud-storage/blob/master/LICENSE)